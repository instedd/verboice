%h2 Call log ##{@log.id}
.call-log-header
  - if @log.not_before
    .item
      %b Not Before:
      = @log.not_before
  - if @log.not_after
    .item
      %b Not After:
      = @log.not_after
  .item
    %b Started:
    = format_timestamp(@log.started_at)
  .item
    %b Finished:
    = format_timestamp(@log.finished_at)
  .item
    %b Duration:
    = distance_of_time_in_words(@log.finished_at, @log.started_at, true) if @log.finished_at and @log.started_at
  .item
    %b Phone number:
    = @log.address
  .item
    %b Direction:
    = @log.direction.capitalize
  .item
    %b Channel:
    = @log.channel.try(:name)
  .item
    %b Schedule:
    = @log.schedule.try(:name) || 'None'
  .item
    %b Project:
    = @log.project.try(:name)
  .item
    %b State:
    = @log.state.capitalize
  - if @log.fail_reason
    .item
      %b Failure information:
      = call_log_fail_info(@log)

%br
%h3 Attachments
.tablewrapp.call-log-attachtments
  %table
    %tr
      %td.description
        CSV
      %td.icon
        %div.i48grad-dataBase
      %td
      %td.details
        = link_to 'Download', download_details_call_log_path(@log, :format => :csv), :class => "button fimport"
    -@log.recorded_audios.each do |recorded_audio|
      %tr
        %td.description
          = recorded_audio.description
        %td.icon
          %div.i48grad-sound
        %td
          %audio{controls: true, controlsList: "nodownload"}
            %source{src: result_call_log_path(@log, :key => recorded_audio.key), type: "audio/mpeg"}
        %td.details
          = link_to 'Download', result_call_log_path(@log, :key => recorded_audio.key), :class => "button fimport"

%br
%h3 Workflow Logs
.tablewrapp.user-flow-log
  %table
    -@activities.each do |activity|
      %tr{:class => activity.fields['error'] ? 'error' : ''}
        %td.timestamp
          - time = Time.parse(activity.start)
          = l(time.to_date, format: :short)
          %br
          = time.strftime("%H:%M:%S.%L")
        %td.icon
          %div{:class => user_step_class(activity.fields['step_type'], !!activity.fields['error'])}
        %td.details
          .step_name= activity.description
          .description
            = activity.fields['error']
            = activity.fields['step_result']
            = activity.fields['step_data']

- if @log.pbx_logs_guid
  %br
  %h3 Network Logs
  %table.GralTable.PbxLogTable
    %tr
      %th{style: 'width:162px'} When
      %th Details
    - @log.pbx_logs.each do |pbx_log|
      %tr
        %td{style: 'width:162px'}= pbx_log.created_at
        %td.call-log-pbx-details
          %span= pbx_log.details
  %br
